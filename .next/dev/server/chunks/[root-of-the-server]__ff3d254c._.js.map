{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma?: PrismaClient\r\n}\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log:\r\n      process.env.NODE_ENV === \"development\"\r\n        ? [\"error\", \"warn\"]\r\n        : [\"error\"],\r\n  })\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  globalForPrisma.prisma = prisma\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KACE,uCACI;QAAC;QAAS;KAAO,GACjB;AACR;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/lib/session.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\r\nimport crypto from \"crypto\"\r\nimport { prisma } from \"./prisma\"\r\nimport type { Session, User } from \"@prisma/client\"\r\n\r\nconst SESSION_COOKIE = \"session_token\"\r\nconst SESSION_MAX_AGE_SECONDS = 60 * 60 * 24 * 30 // 30 days\r\n\r\nexport type SessionWithUser = Session & {\r\n  user: User & {\r\n    organization: { id: string; name: string; isRejected: boolean } | null\r\n  }\r\n}\r\n\r\nexport function serializeUser(\r\n  user: User & { organization?: { id: string; name: string; isRejected?: boolean } | null },\r\n) {\r\n  const { passwordHash: _passwordHash, ...safeUser } = user\r\n\r\n  return {\r\n    ...safeUser,\r\n    organization: user.organization\r\n      ? {\r\n          id: user.organization.id,\r\n          name: user.organization.name,\r\n          isRejected: Boolean(user.organization.isRejected),\r\n        }\r\n      : null,\r\n  }\r\n}\r\n\r\nexport async function getSession(): Promise<SessionWithUser | null> {\r\n  const cookieStore = await cookies()\r\n  const token = cookieStore.get(SESSION_COOKIE)?.value\r\n  if (!token) return null\r\n\r\n  const session = await prisma.session.findUnique({\r\n    where: { token },\r\n    include: {\r\n      user: {\r\n        include: {\r\n          organization: {\r\n            select: { id: true, name: true, isRejected: true },\r\n          },\r\n        },\r\n      },\r\n    },\r\n  })\r\n\r\n  if (!session) {\r\n    cookieStore.delete(SESSION_COOKIE)\r\n    return null\r\n  }\r\n\r\n  if (session.expiresAt < new Date()) {\r\n    await prisma.session.delete({ where: { token } })\r\n    cookieStore.delete(SESSION_COOKIE)\r\n    return null\r\n  }\r\n\r\n  return session as SessionWithUser\r\n}\r\n\r\nexport async function getCurrentUser() {\r\n  const session = await getSession()\r\n  return session ? serializeUser(session.user) : null\r\n}\r\n\r\nexport async function createSession(userId: string) {\r\n  const token = crypto.randomUUID()\r\n  const expiresAt = new Date(Date.now() + SESSION_MAX_AGE_SECONDS * 1000)\r\n\r\n  await prisma.session.create({\r\n    data: {\r\n      token,\r\n      userId,\r\n      expiresAt,\r\n    },\r\n  })\r\n\r\n  const cookieStore = await cookies()\r\n  cookieStore.set(SESSION_COOKIE, token, {\r\n    httpOnly: true,\r\n    sameSite: \"lax\",\r\n    secure: process.env.NODE_ENV === \"production\",\r\n    maxAge: SESSION_MAX_AGE_SECONDS,\r\n    path: \"/\",\r\n  })\r\n\r\n  return token\r\n}\r\n\r\nexport async function clearSession() {\r\n  const cookieStore = await cookies()\r\n  const token = cookieStore.get(SESSION_COOKIE)?.value\r\n\r\n  if (token) {\r\n    await prisma.session.deleteMany({ where: { token } })\r\n  }\r\n\r\n  cookieStore.delete(SESSION_COOKIE)\r\n}\r\n\r\nexport async function requireUser() {\r\n  const user = await getCurrentUser()\r\n  if (!user) {\r\n    throw new Error(\"UNAUTHENTICATED\")\r\n  }\r\n  return user\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAGA,MAAM,iBAAiB;AACvB,MAAM,0BAA0B,KAAK,KAAK,KAAK,GAAG,UAAU;;AAQrD,SAAS,cACd,IAAyF;IAEzF,MAAM,EAAE,cAAc,aAAa,EAAE,GAAG,UAAU,GAAG;IAErD,OAAO;QACL,GAAG,QAAQ;QACX,cAAc,KAAK,YAAY,GAC3B;YACE,IAAI,KAAK,YAAY,CAAC,EAAE;YACxB,MAAM,KAAK,YAAY,CAAC,IAAI;YAC5B,YAAY,QAAQ,KAAK,YAAY,CAAC,UAAU;QAClD,IACA;IACN;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6KAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,iBAAiB;IAC/C,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,UAAU,MAAM,0JAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QAC9C,OAAO;YAAE;QAAM;QACf,SAAS;YACP,MAAM;gBACJ,SAAS;oBACP,cAAc;wBACZ,QAAQ;4BAAE,IAAI;4BAAM,MAAM;4BAAM,YAAY;wBAAK;oBACnD;gBACF;YACF;QACF;IACF;IAEA,IAAI,CAAC,SAAS;QACZ,YAAY,MAAM,CAAC;QACnB,OAAO;IACT;IAEA,IAAI,QAAQ,SAAS,GAAG,IAAI,QAAQ;QAClC,MAAM,0JAAM,CAAC,OAAO,CAAC,MAAM,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;QAC/C,YAAY,MAAM,CAAC;QACnB,OAAO;IACT;IAEA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,OAAO,UAAU,cAAc,QAAQ,IAAI,IAAI;AACjD;AAEO,eAAe,cAAc,MAAc;IAChD,MAAM,QAAQ,gHAAM,CAAC,UAAU;IAC/B,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,0BAA0B;IAElE,MAAM,0JAAM,CAAC,OAAO,CAAC,MAAM,CAAC;QAC1B,MAAM;YACJ;YACA;YACA;QACF;IACF;IAEA,MAAM,cAAc,MAAM,IAAA,6KAAO;IACjC,YAAY,GAAG,CAAC,gBAAgB,OAAO;QACrC,UAAU;QACV,UAAU;QACV,QAAQ,oDAAyB;QACjC,QAAQ;QACR,MAAM;IACR;IAEA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6KAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,iBAAiB;IAE/C,IAAI,OAAO;QACT,MAAM,0JAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;IACrD;IAEA,YAAY,MAAM,CAAC;AACrB;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 214, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/lib/auth-server.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\r\nimport \"server-only\"\r\nimport { NextResponse } from \"next/server\"\r\nimport { randomUUID } from \"crypto\"\r\nimport { SignJWT, jwtVerify } from \"jose\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport { prisma } from \"./prisma\"\r\nimport { UserRole } from \"@prisma/client\"\r\n\r\nconst SESSION_COOKIE = \"session_token\"\r\nconst SESSION_DURATION_MS = 1000 * 60 * 60 * 24 * 7\r\n\r\nfunction getSecret() {\r\n  const secret = process.env.JWT_SECRET\r\n  if (!secret) {\r\n    throw new Error(\"Missing JWT_SECRET\")\r\n  }\r\n  return new TextEncoder().encode(secret)\r\n}\r\n\r\nexport async function hashPassword(password: string) {\r\n  return bcrypt.hash(password, 10)\r\n}\r\n\r\nexport async function verifyPassword(password: string, hash: string) {\r\n  return bcrypt.compare(password, hash)\r\n}\r\n\r\nexport async function createAuthSession(userId: string, role: UserRole) {\r\n  const token = randomUUID()\r\n  const expiresAt = new Date(Date.now() + SESSION_DURATION_MS)\r\n\r\n  await prisma.session.create({\r\n    data: {\r\n      token,\r\n      userId,\r\n      expiresAt,\r\n    },\r\n  })\r\n\r\n  const jwt = await new SignJWT({ token, role })\r\n    .setProtectedHeader({ alg: \"HS256\" })\r\n    .setExpirationTime(expiresAt)\r\n    .sign(getSecret())\r\n\r\n  const cookieStore = await cookies()\r\n  cookieStore.set(SESSION_COOKIE, jwt, {\r\n    httpOnly: true,\r\n    sameSite: \"lax\",\r\n    expires: expiresAt,\r\n    path: \"/\",\r\n    secure: process.env.NODE_ENV === \"production\",\r\n  })\r\n  return token\r\n}\r\n\r\nexport async function clearSession() {\r\n  const cookieStore = await cookies()\r\n  const token = cookieStore.get(SESSION_COOKIE)?.value\r\n  if (token) {\r\n    await prisma.session.deleteMany({ where: { token } })\r\n  }\r\n  cookieStore.delete(SESSION_COOKIE)\r\n}\r\n\r\nexport async function getSessionUser() {\r\n  const cookieStore = await cookies()\r\n  const jwt = cookieStore.get(SESSION_COOKIE)?.value\r\n  if (!jwt) return null\r\n\r\n  try {\r\n    const { payload } = await jwtVerify(jwt, getSecret())\r\n    const token = payload.token as string\r\n    if (!token) return null\r\n    const session = await prisma.session.findUnique({\r\n      where: { token },\r\n      include: {\r\n        user: {\r\n          include: { organization: { select: { id: true, name: true, isRejected: true } } },\r\n        },\r\n      },\r\n    })\r\n    if (!session || session.expiresAt < new Date()) {\r\n      return null\r\n    }\r\n    if (session.user.status === \"suspended\") {\r\n      await prisma.session.deleteMany({ where: { token } })\r\n      cookieStore.delete(SESSION_COOKIE)\r\n      return null\r\n    }\r\n    return session.user\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nexport function requireRole(userRole: UserRole, allowed: UserRole[]) {\r\n  if (!allowed.includes(userRole)) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\r\n  }\r\n  return null\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;AAGA,MAAM,iBAAiB;AACvB,MAAM,sBAAsB,OAAO,KAAK,KAAK,KAAK;AAElD,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;IACrC,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IACA,OAAO,IAAI,cAAc,MAAM,CAAC;AAClC;AAEO,eAAe,aAAa,QAAgB;IACjD,OAAO,+KAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,IAAY;IACjE,OAAO,+KAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe,kBAAkB,MAAc,EAAE,IAAc;IACpE,MAAM,QAAQ,IAAA,mHAAU;IACxB,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK;IAExC,MAAM,0JAAM,CAAC,OAAO,CAAC,MAAM,CAAC;QAC1B,MAAM;YACJ;YACA;YACA;QACF;IACF;IAEA,MAAM,MAAM,MAAM,IAAI,wMAAO,CAAC;QAAE;QAAO;IAAK,GACzC,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,WAClB,IAAI,CAAC;IAER,MAAM,cAAc,MAAM,IAAA,6KAAO;IACjC,YAAY,GAAG,CAAC,gBAAgB,KAAK;QACnC,UAAU;QACV,UAAU;QACV,SAAS;QACT,MAAM;QACN,QAAQ,oDAAyB;IACnC;IACA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6KAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,iBAAiB;IAC/C,IAAI,OAAO;QACT,MAAM,0JAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;IACrD;IACA,YAAY,MAAM,CAAC;AACrB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6KAAO;IACjC,MAAM,MAAM,YAAY,GAAG,CAAC,iBAAiB;IAC7C,IAAI,CAAC,KAAK,OAAO;IAEjB,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,4MAAS,EAAC,KAAK;QACzC,MAAM,QAAQ,QAAQ,KAAK;QAC3B,IAAI,CAAC,OAAO,OAAO;QACnB,MAAM,UAAU,MAAM,0JAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAC9C,OAAO;gBAAE;YAAM;YACf,SAAS;gBACP,MAAM;oBACJ,SAAS;wBAAE,cAAc;4BAAE,QAAQ;gCAAE,IAAI;gCAAM,MAAM;gCAAM,YAAY;4BAAK;wBAAE;oBAAE;gBAClF;YACF;QACF;QACA,IAAI,CAAC,WAAW,QAAQ,SAAS,GAAG,IAAI,QAAQ;YAC9C,OAAO;QACT;QACA,IAAI,QAAQ,IAAI,CAAC,MAAM,KAAK,aAAa;YACvC,MAAM,0JAAM,CAAC,OAAO,CAAC,UAAU,CAAC;gBAAE,OAAO;oBAAE;gBAAM;YAAE;YACnD,YAAY,MAAM,CAAC;YACnB,OAAO;QACT;QACA,OAAO,QAAQ,IAAI;IACrB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,YAAY,QAAkB,EAAE,OAAmB;IACjE,IAAI,CAAC,QAAQ,QAAQ,CAAC,WAAW;QAC/B,OAAO,iLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;IACjE;IACA,OAAO;AACT"}},
    {"offset": {"line": 353, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/lib/services/auth.ts"],"sourcesContent":["import \"server-only\"\r\n\r\nimport bcrypt from \"bcryptjs\"\r\nimport { z } from \"zod\"\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { serializeUser } from \"@/lib/session\"\r\nimport { clearSession, createAuthSession, getSessionUser } from \"@/lib/auth-server\"\r\n\r\nconst registerSchema = z.object({\r\n  role: z.enum([\"customer\", \"installer\"]),\r\n  email: z.string().email(),\r\n  password: z.string().min(8),\r\n  name: z.string(),\r\n  phone: z.string().optional(),\r\n  address: z.string().optional(),\r\n  companyName: z.string().optional(),\r\n  description: z.string().optional(),\r\n})\r\n\r\nconst loginSchema = z.object({\r\n  email: z.string().email(),\r\n  password: z.string().min(1),\r\n})\r\n\r\nexport type PublicUser = ReturnType<typeof serializeUser>\r\n\r\nexport async function registerUser(input: unknown) {\r\n  const data = registerSchema.parse(input)\r\n\r\n  const existing = await prisma.user.findUnique({ where: { email: data.email } })\r\n  if (existing) {\r\n    throw new Error(\"An account with this email already exists\")\r\n  }\r\n\r\n  const passwordHash = await bcrypt.hash(data.password, 10)\r\n\r\n  let organizationId: string | undefined\r\n  if (data.role === \"installer\") {\r\n    const organization = await prisma.organization.create({\r\n      data: {\r\n        name: data.companyName || `${data.name}'s Solar`,\r\n        description: data.description,\r\n        verified: false,\r\n      },\r\n    })\r\n    organizationId = organization.id\r\n  }\r\n\r\n  const user = await prisma.user.create({\r\n    data: {\r\n      email: data.email,\r\n      name: data.name,\r\n      role: data.role,\r\n      status: \"active\",\r\n      phone: data.phone,\r\n      address: data.address,\r\n      passwordHash,\r\n      organizationId,\r\n      verified: data.role === \"customer\",\r\n    },\r\n    include: { organization: { select: { id: true, name: true, isRejected: true } } },\r\n  })\r\n\r\n  await createAuthSession(user.id, user.role)\r\n\r\n  return serializeUser(user)\r\n}\r\n\r\nexport async function loginUser(input: unknown) {\r\n  const data = loginSchema.parse(input)\r\n\r\n  const user = await prisma.user.findUnique({\r\n    where: { email: data.email },\r\n    include: { organization: { select: { id: true, name: true, isRejected: true } } },\r\n  })\r\n\r\n  if (!user) {\r\n    throw new Error(\"Invalid credentials\")\r\n  }\r\n\r\n  const isValid = await bcrypt.compare(data.password, user.passwordHash)\r\n  if (!isValid) {\r\n    throw new Error(\"Invalid credentials\")\r\n  }\r\n\r\n  await createAuthSession(user.id, user.role)\r\n  return serializeUser(user)\r\n}\r\n\r\nexport async function logoutUser() {\r\n  await clearSession()\r\n}\r\n\r\nexport async function currentUser() {\r\n  const user = await getSessionUser()\r\n  if (!user) return null\r\n\r\n  const fullUser = await prisma.user.findUnique({\r\n    where: { id: user.id },\r\n    include: { organization: { select: { id: true, name: true, isRejected: true } } },\r\n  })\r\n\r\n  return fullUser ? serializeUser(fullUser) : null\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 491, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/lib/pdf.ts"],"sourcesContent":["function escapePdfText(value: string) {\r\n  return value.replace(/\\\\/g, \"\\\\\\\\\").replace(/\\(/g, \"\\\\(\").replace(/\\)/g, \"\\\\)\")\r\n}\r\n\r\ntype PdfSection = {\r\n  title: string\r\n  lines: { label: string; value: string }[]\r\n}\r\n\r\nexport function buildSimplePdf(title: string, lines: string[]) {\r\n  const contentLines = [\r\n    \"BT\",\r\n    \"/F1 18 Tf\",\r\n    \"72 740 Td\",\r\n    `(${escapePdfText(title)}) Tj`,\r\n    \"/F1 12 Tf\",\r\n    \"16 TL\",\r\n    ...lines.map((line) => `T* (${escapePdfText(line)}) Tj`),\r\n    \"ET\",\r\n  ].join(\"\\n\")\r\n\r\n  const objects: string[] = []\r\n  objects[1] = \"1 0 obj\\n<< /Type /Catalog /Pages 2 0 R >>\\nendobj\\n\"\r\n  objects[2] = \"2 0 obj\\n<< /Type /Pages /Kids [3 0 R] /Count 1 >>\\nendobj\\n\"\r\n  objects[3] =\r\n    \"3 0 obj\\n<< /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Contents 4 0 R /Resources << /Font << /F1 5 0 R >> >> >>\\nendobj\\n\"\r\n  objects[4] =\r\n    `4 0 obj\\n<< /Length ${Buffer.byteLength(contentLines, \"utf8\")} >>\\nstream\\n${contentLines}\\nendstream\\nendobj\\n`\r\n  objects[5] =\r\n    \"5 0 obj\\n<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>\\nendobj\\n\"\r\n\r\n  let pdf = \"%PDF-1.4\\n\"\r\n  const offsets: number[] = [0]\r\n  for (let i = 1; i <= 5; i += 1) {\r\n    offsets[i] = pdf.length\r\n    pdf += objects[i]\r\n  }\r\n  const xrefStart = pdf.length\r\n  pdf += \"xref\\n0 6\\n0000000000 65535 f \\n\"\r\n  for (let i = 1; i <= 5; i += 1) {\r\n    pdf += `${String(offsets[i]).padStart(10, \"0\")} 00000 n \\n`\r\n  }\r\n  pdf += \"trailer\\n<< /Size 6 /Root 1 0 R >>\\nstartxref\\n\"\r\n  pdf += `${xrefStart}\\n%%EOF\\n`\r\n  return Buffer.from(pdf, \"utf8\")\r\n}\r\n\r\nexport function buildReportPdf({\r\n  title,\r\n  subtitle,\r\n  sections,\r\n  footer,\r\n}: {\r\n  title: string\r\n  subtitle?: string\r\n  sections: PdfSection[]\r\n  footer?: string\r\n}) {\r\n  const content: string[] = []\r\n\r\n  // Header background\r\n  content.push(\"0.93 0.97 0.99 rg\")\r\n  content.push(\"0 720 612 72 re f\")\r\n\r\n  // Title\r\n  content.push(\"0 0 0 rg\")\r\n  content.push(\"BT\")\r\n  content.push(\"/F1 18 Tf\")\r\n  content.push(\"72 760 Td\")\r\n  content.push(`(${escapePdfText(title)}) Tj`)\r\n  if (subtitle) {\r\n    content.push(\"/F1 10 Tf\")\r\n    content.push(\"0 -18 Td\")\r\n    content.push(`(${escapePdfText(subtitle)}) Tj`)\r\n  }\r\n  content.push(\"ET\")\r\n\r\n  let y = 680\r\n  sections.forEach((section) => {\r\n    content.push(\"BT\")\r\n    content.push(\"/F1 12 Tf\")\r\n    content.push(`72 ${y} Td`)\r\n    content.push(`(${escapePdfText(section.title)}) Tj`)\r\n    content.push(\"ET\")\r\n    y -= 16\r\n\r\n    section.lines.forEach((line) => {\r\n      content.push(\"BT\")\r\n      content.push(\"/F1 10 Tf\")\r\n      content.push(`72 ${y} Td`)\r\n      content.push(`(${escapePdfText(line.label)}) Tj`)\r\n      content.push(\"ET\")\r\n      content.push(\"BT\")\r\n      content.push(\"/F1 10 Tf\")\r\n      content.push(`360 ${y} Td`)\r\n      content.push(`(${escapePdfText(line.value)}) Tj`)\r\n      content.push(\"ET\")\r\n      y -= 14\r\n    })\r\n\r\n    y -= 10\r\n    content.push(\"0.85 0.85 0.85 RG\")\r\n    content.push(`72 ${y} m 540 ${y} l S`)\r\n    y -= 14\r\n  })\r\n\r\n  if (footer) {\r\n    content.push(\"0 0 0 rg\")\r\n    content.push(\"BT\")\r\n    content.push(\"/F1 9 Tf\")\r\n    content.push(`72 ${y} Td`)\r\n    content.push(`(${escapePdfText(footer)}) Tj`)\r\n    content.push(\"ET\")\r\n  }\r\n\r\n  const contentLines = content.join(\"\\n\")\r\n\r\n  const objects: string[] = []\r\n  objects[1] = \"1 0 obj\\n<< /Type /Catalog /Pages 2 0 R >>\\nendobj\\n\"\r\n  objects[2] = \"2 0 obj\\n<< /Type /Pages /Kids [3 0 R] /Count 1 >>\\nendobj\\n\"\r\n  objects[3] =\r\n    \"3 0 obj\\n<< /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Contents 4 0 R /Resources << /Font << /F1 5 0 R >> >> >>\\nendobj\\n\"\r\n  objects[4] =\r\n    `4 0 obj\\n<< /Length ${Buffer.byteLength(contentLines, \"utf8\")} >>\\nstream\\n${contentLines}\\nendstream\\nendobj\\n`\r\n  objects[5] =\r\n    \"5 0 obj\\n<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>\\nendobj\\n\"\r\n\r\n  let pdf = \"%PDF-1.4\\n\"\r\n  const offsets: number[] = [0]\r\n  for (let i = 1; i <= 5; i += 1) {\r\n    offsets[i] = pdf.length\r\n    pdf += objects[i]\r\n  }\r\n  const xrefStart = pdf.length\r\n  pdf += \"xref\\n0 6\\n0000000000 65535 f \\n\"\r\n  for (let i = 1; i <= 5; i += 1) {\r\n    pdf += `${String(offsets[i]).padStart(10, \"0\")} 00000 n \\n`\r\n  }\r\n  pdf += \"trailer\\n<< /Size 6 /Root 1 0 R >>\\nstartxref\\n\"\r\n  pdf += `${xrefStart}\\n%%EOF\\n`\r\n  return Buffer.from(pdf, \"utf8\")\r\n}\r\n\r\nexport async function writePdfToPublic({\r\n  filename,\r\n  buffer,\r\n}: {\r\n  filename: string\r\n  buffer: Buffer\r\n}) {\r\n  const { promises: fs } = await import(\"fs\")\r\n  const path = await import(\"path\")\r\n  const dir = path.join(process.cwd(), \"public\", \"pdfs\")\r\n  await fs.mkdir(dir, { recursive: true })\r\n  const filePath = path.join(dir, filename)\r\n  await fs.writeFile(filePath, buffer)\r\n  return `/pdfs/${filename}`\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 626, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/lib/notifications.ts"],"sourcesContent":["import { PaymentTransaction, Invoice } from \"./prisma-types\"\r\nimport { prisma } from \"@/lib/prisma\"\r\n\r\ninterface EmailPayload {\r\n  to: string\r\n  subject: string\r\n  body: string\r\n}\r\n\r\nasync function sendEmail({ to, subject, body }: EmailPayload) {\r\n  const smtpUser = process.env.GMAIL_USER\r\n  const smtpPass = process.env.GMAIL_APP_PASSWORD\r\n\r\n  if (!smtpUser || !smtpPass) {\r\n    console.log(\"[notification] email\", { to, subject, body })\r\n    return\r\n  }\r\n\r\n  const module = await import(\"nodemailer\").catch(() => null)\r\n  if (!module) {\r\n    console.log(\"[notification] email\", { to, subject, body })\r\n    return\r\n  }\r\n\r\n  const nodemailer = (module as any).default ?? module\r\n  const transporter = nodemailer.createTransport({\r\n    service: \"gmail\",\r\n    auth: {\r\n      user: smtpUser,\r\n      pass: smtpPass,\r\n    },\r\n  })\r\n\r\n  try {\r\n    await transporter.sendMail({\r\n      from: smtpUser,\r\n      to,\r\n      subject,\r\n      text: body,\r\n    })\r\n  } catch (error) {\r\n    console.warn(\"[notification] email failed\", error)\r\n  }\r\n}\r\n\r\nasync function createNotification(userId: string, title: string, body: string, link?: string) {\r\n  try {\r\n    await prisma.notification.create({\r\n      data: {\r\n        userId,\r\n        title,\r\n        body,\r\n        link,\r\n      },\r\n    })\r\n  } catch (error) {\r\n    console.warn(\"[notification] failed to persist notification\", error)\r\n  }\r\n}\r\n\r\nasync function resolveEmail(userId: string) {\r\n  const user = await prisma.user.findUnique({ where: { id: userId } })\r\n  return user?.email ?? `${userId}@example.com`\r\n}\r\n\r\nexport async function sendPaymentApprovedNotification(payment: PaymentTransaction) {\r\n  const to = await resolveEmail(payment.customerId)\r\n  await sendEmail({\r\n    to,\r\n    subject: `Payment ${payment.id} approved`,\r\n    body: `Your payment for ${payment.type} has been approved. Reference: ${payment.reference ?? payment.id}.`,\r\n  })\r\n  await createNotification(\r\n    payment.customerId,\r\n    \"Payment approved\",\r\n    `Your payment ${payment.id} has been approved.`,\r\n  )\r\n}\r\n\r\nexport async function sendPaymentRejectedNotification(payment: PaymentTransaction) {\r\n  const to = await resolveEmail(payment.customerId)\r\n  await sendEmail({\r\n    to,\r\n    subject: `Payment ${payment.id} rejected`,\r\n    body: `Your payment could not be approved. Notes: ${payment.notes ?? \"None provided.\"}`,\r\n  })\r\n  await createNotification(\r\n    payment.customerId,\r\n    \"Payment rejected\",\r\n    `Your payment ${payment.id} was rejected. ${payment.notes ?? \"\"}`.trim(),\r\n  )\r\n}\r\n\r\nexport async function sendPaymentReminder(invoice: Invoice) {\r\n  const to = await resolveEmail(invoice.customerId)\r\n  await sendEmail({\r\n    to,\r\n    subject: `Reminder: Invoice ${invoice.id} is pending`,\r\n    body: `${invoice.description} is due on ${new Date(invoice.dueDate).toDateString()}. Amount: ${invoice.amount}.`,\r\n  })\r\n  await createNotification(\r\n    invoice.customerId,\r\n    \"Payment reminder\",\r\n    `${invoice.description} is due on ${new Date(invoice.dueDate).toDateString()}.`,\r\n  )\r\n}\r\n\r\nexport async function sendInstallationUpdate(customerId: string, message: string) {\r\n  const to = await resolveEmail(customerId)\r\n  await sendEmail({\r\n    to,\r\n    subject: \"Installation update\",\r\n    body: message,\r\n  })\r\n  await createNotification(customerId, \"Installation update\", message)\r\n}\r\n\r\nexport async function sendAgreementNotification(userId: string, message: string, link?: string) {\r\n  const to = await resolveEmail(userId)\r\n  await sendEmail({\r\n    to,\r\n    subject: \"Agreement update\",\r\n    body: message,\r\n  })\r\n  await createNotification(userId, \"Agreement update\", message, link)\r\n}\r\n\r\nexport async function sendSiteVisitScheduledNotification(\r\n  customerId: string,\r\n  visitDate: Date,\r\n  address?: string | null,\r\n) {\r\n  const dateLabel = visitDate.toLocaleString([], {\r\n    year: \"numeric\",\r\n    month: \"short\",\r\n    day: \"numeric\",\r\n    hour: \"2-digit\",\r\n    minute: \"2-digit\",\r\n  })\r\n  const body = address\r\n    ? `A site visit has been scheduled for ${dateLabel} at ${address}.`\r\n    : `A site visit has been scheduled for ${dateLabel}.`\r\n  const to = await resolveEmail(customerId)\r\n  await sendEmail({\r\n    to,\r\n    subject: \"Site visit scheduled\",\r\n    body,\r\n  })\r\n  await createNotification(customerId, \"Site visit scheduled\", body)\r\n}\r\n\r\nexport async function sendSiteVisitRescheduledNotification(\r\n  customerId: string,\r\n  visitDate: Date,\r\n  address?: string | null,\r\n) {\r\n  const dateLabel = visitDate.toLocaleString([], {\r\n    year: \"numeric\",\r\n    month: \"short\",\r\n    day: \"numeric\",\r\n    hour: \"2-digit\",\r\n    minute: \"2-digit\",\r\n  })\r\n  const body = address\r\n    ? `A site visit has been rescheduled for ${dateLabel} at ${address}.`\r\n    : `A site visit has been rescheduled for ${dateLabel}.`\r\n  const to = await resolveEmail(customerId)\r\n  await sendEmail({\r\n    to,\r\n    subject: \"Reschedule site visit\",\r\n    body,\r\n  })\r\n  await createNotification(customerId, \"Reschedule site visit\", body)\r\n}\r\n\r\nexport async function sendApplicationDecisionNotification(\r\n  customerId: string,\r\n  status: \"approved\" | \"rejected\",\r\n  reason?: string | null,\r\n) {\r\n  const subject = status === \"approved\" ? \"Application approved\" : \"Application rejected\"\r\n  const body =\r\n    status === \"approved\"\r\n      ? \"Your solar application has been approved. You may now proceed with package selection.\"\r\n      : `Your solar application was rejected. ${reason ?? \"Please contact support for details.\"}`\r\n  const to = await resolveEmail(customerId)\r\n  await sendEmail({\r\n    to,\r\n    subject,\r\n    body,\r\n  })\r\n  await createNotification(customerId, subject, body)\r\n}\r\n\r\nexport async function sendPreVisitApprovalNotification(customerId: string) {\r\n  const subject = \"Application approved - site visit payment required\"\r\n  const body =\r\n    \"Your application has been approved. Please pay the site visit fee so we can schedule your visit.\"\r\n  const to = await resolveEmail(customerId)\r\n  await sendEmail({\r\n    to,\r\n    subject,\r\n    body,\r\n  })\r\n  await createNotification(customerId, subject, body)\r\n}\r\n\r\nexport async function sendInstallerVerificationNotification(\r\n  installerUserId: string,\r\n  status: \"verified\" | \"suspended\" | \"rejected\",\r\n  reason?: string | null,\r\n) {\r\n  const subject =\r\n    status === \"verified\"\r\n      ? \"Installer verification approved\"\r\n      : status === \"suspended\"\r\n      ? \"Installer account suspended\"\r\n      : \"Installer verification rejected\"\r\n  const body =\r\n    status === \"verified\"\r\n      ? \"Your installer organization has been verified.\"\r\n      : status === \"suspended\"\r\n      ? \"Your installer organization has been suspended. Please contact support.\"\r\n      : `Your installer organization was rejected.${reason ? ` Reason: ${reason}` : \" Please contact support for details.\"}`\r\n\r\n  const to = await resolveEmail(installerUserId)\r\n  await sendEmail({\r\n    to,\r\n    subject,\r\n    body,\r\n  })\r\n  await createNotification(installerUserId, subject, body)\r\n}\r\n\r\nexport async function sendBidAcceptedNotification(\r\n  customerId: string,\r\n  installerUserId: string,\r\n  bidPrice: number,\r\n) {\r\n  const subject = \"Bid accepted\"\r\n  const body = `A bid has been accepted for LKR ${bidPrice.toLocaleString()}. Please proceed with the installation payment.`\r\n  const installerEmail = await resolveEmail(installerUserId)\r\n  await sendEmail({\r\n    to: installerEmail,\r\n    subject,\r\n    body,\r\n  })\r\n  await createNotification(installerUserId, subject, body)\r\n  await createNotification(customerId, subject, body)\r\n}\r\n\r\nexport async function sendInvoicePaidNotification(\r\n  customerId: string,\r\n  invoiceId: string,\r\n  amount: number,\r\n) {\r\n  const subject = \"Payment received\"\r\n  const body = `Your payment for invoice ${invoiceId} (LKR ${amount.toLocaleString()}) was received.`\r\n  const to = await resolveEmail(customerId)\r\n  await sendEmail({\r\n    to,\r\n    subject,\r\n    body,\r\n  })\r\n  await createNotification(customerId, subject, body)\r\n}\r\n\r\nexport async function sendSiteVisitPaymentCompletedNotification(\r\n  applicationId: string,\r\n  invoiceId: string,\r\n  amount: number,\r\n) {\r\n  const application = await prisma.application.findUnique({\r\n    where: { id: applicationId },\r\n    include: { customer: true },\r\n  })\r\n\r\n  if (!application) return\r\n\r\n  const officers = await prisma.user.findMany({\r\n    where: { role: \"officer\", status: \"active\" },\r\n    select: { id: true },\r\n  })\r\n\r\n  if (officers.length === 0) return\r\n\r\n  const amountLabel = `LKR ${Number(amount).toLocaleString()}`\r\n  const visitDate = application.siteVisitDate\r\n    ? ` Site visit date: ${application.siteVisitDate.toLocaleString()}.`\r\n    : \"\"\r\n  const address = application.customer?.address\r\n    ? ` Address: ${application.customer.address}.`\r\n    : \"\"\r\n\r\n  const title = \"Site visit payment completed\"\r\n  const body = `Application ${application.reference} for ${application.customer?.name ?? \"customer\"} paid the site visit fee (${amountLabel}). Invoice ${invoiceId}.${visitDate}${address}`.trim()\r\n\r\n  await Promise.all(\r\n    officers.map((officer) =>\r\n      createNotification(officer.id, title, body, \"/officer/applications\"),\r\n    ),\r\n  )\r\n}\r\n\r\nexport async function sendInstallationPaymentCompletedNotification(\r\n  applicationId: string,\r\n  invoiceId: string,\r\n  amount: number,\r\n) {\r\n  const application = await prisma.application.findUnique({\r\n    where: { id: applicationId },\r\n    include: {\r\n      customer: true,\r\n      installerOrganization: { include: { users: true } },\r\n    },\r\n  })\r\n\r\n  if (!application?.installerOrganization) return\r\n\r\n  const installerUsers = application.installerOrganization.users.filter(\r\n    (user) => user.role === \"installer\" && user.status === \"active\",\r\n  )\r\n\r\n  if (installerUsers.length === 0) return\r\n\r\n  const amountLabel = `LKR ${Number(amount).toLocaleString()}`\r\n  const title = \"Installation payment completed\"\r\n  const body = `Installation payment received for application ${application.reference} (${amountLabel}). Invoice ${invoiceId}. Customer: ${application.customer?.name ?? \"N/A\"}.`\r\n\r\n  await Promise.all(\r\n    installerUsers.map((user) =>\r\n      createNotification(user.id, title, body, \"/installer/orders\"),\r\n    ),\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 907, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/app/api/agreements/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { currentUser } from \"@/lib/services/auth\"\r\nimport { buildSimplePdf, writePdfToPublic } from \"@/lib/pdf\"\r\nimport { sendAgreementNotification } from \"@/lib/notifications\"\r\n\r\nfunction buildCustomerAgreementLines({\r\n  customerName,\r\n  installerName,\r\n  senderName,\r\n  dateLabel,\r\n}: {\r\n  customerName: string\r\n  installerName?: string | null\r\n  senderName: string\r\n  dateLabel: string\r\n}) {\r\n  return [\r\n    `To: ${customerName}`,\r\n    `From: ${senderName}`,\r\n    `Date: ${dateLabel}`,\r\n    \"Subject: Solar Installation Agreement\",\r\n    \"\",\r\n    `I acknowledge that I selected ${installerName ?? \"the installer\"} through the platform and agree to the terms`,\r\n    \"of the solar installation. I am responsible for providing accurate information and cooperating\",\r\n    \"with the installer and officer during installation, inspection, and commissioning.\",\r\n    \"\",\r\n    \"Signature: ______________________________\",\r\n    \"Name: _________________________________\",\r\n    \"Date: _________________________________\",\r\n  ]\r\n}\r\n\r\nfunction buildInstallerAgreementLines({\r\n  installerName,\r\n  customerName,\r\n  senderName,\r\n  dateLabel,\r\n  packageName,\r\n  panelCount,\r\n  panelType,\r\n  inverterBrand,\r\n  warranty,\r\n}: {\r\n  installerName?: string | null\r\n  customerName: string\r\n  senderName: string\r\n  dateLabel: string\r\n  packageName?: string | null\r\n  panelCount?: number | null\r\n  panelType?: string | null\r\n  inverterBrand?: string | null\r\n  warranty?: string | null\r\n}) {\r\n  const panelDetails = [\r\n    packageName ? `Package: ${packageName}` : null,\r\n    panelCount ? `Panel Count: ${panelCount}` : null,\r\n    panelType ? `Panel Type: ${panelType}` : null,\r\n    inverterBrand ? `Inverter Brand: ${inverterBrand}` : null,\r\n    warranty ? `Warranty: ${warranty}` : null,\r\n  ].filter(Boolean) as string[]\r\n\r\n  return [\r\n    `To: ${installerName ?? \"Installer\"}`,\r\n    `From: ${senderName}`,\r\n    `Date: ${dateLabel}`,\r\n    \"Subject: Solar Installation Agreement\",\r\n    \"\",\r\n    `I confirm the solar installation for ${customerName} and commit to providing the agreed`,\r\n    \"equipment, workmanship, and warranty coverage as described below.\",\r\n    ...panelDetails,\r\n    \"\",\r\n    \"Signature: ______________________________\",\r\n    \"Name: _________________________________\",\r\n    \"Date: _________________________________\",\r\n  ]\r\n}\r\n\r\nexport async function GET(request: Request) {\r\n  const user = await currentUser()\r\n  if (!user) {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n  }\r\n\r\n  const url = new URL(request.url)\r\n  const applicationRef = url.searchParams.get(\"applicationId\")\r\n  if (!applicationRef) {\r\n    return NextResponse.json({ error: \"Application ID is required\" }, { status: 400 })\r\n  }\r\n\r\n  const application = await prisma.application.findFirst({\r\n    where: { reference: applicationRef },\r\n    include: { customer: true, installerOrganization: true, selectedPackage: true },\r\n  })\r\n\r\n  if (!application) {\r\n    return NextResponse.json({ error: \"Application not found\" }, { status: 404 })\r\n  }\r\n\r\n  if (user.role === \"customer\" && application.customerId !== user.id) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\r\n  }\r\n  if (user.role === \"installer\" && application.installerOrganizationId !== user.organization?.id) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\r\n  }\r\n\r\n  const agreement = await prisma.agreement.findFirst({\r\n    where: { applicationId: application.id },\r\n  })\r\n\r\n  return NextResponse.json({ agreement })\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  const user = await currentUser()\r\n  if (!user || user.role !== \"officer\") {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n  }\r\n\r\n  const body = await request.json().catch(() => ({}))\r\n  const applicationRef = body.applicationId as string | undefined\r\n  if (!applicationRef) {\r\n    return NextResponse.json({ error: \"Application ID is required\" }, { status: 400 })\r\n  }\r\n\r\n  const application = await prisma.application.findFirst({\r\n    where: { reference: applicationRef },\r\n    include: { customer: true, installerOrganization: true, selectedPackage: true },\r\n  })\r\n\r\n  if (!application) {\r\n    return NextResponse.json({ error: \"Application not found\" }, { status: 404 })\r\n  }\r\n\r\n  const senderName = user.name || \"Officer\"\r\n  const dateLabel = new Date().toLocaleDateString()\r\n\r\n  const customerPdf = buildSimplePdf(\r\n    \"Solar Installation Agreement (Customer)\",\r\n    buildCustomerAgreementLines({\r\n      customerName: application.customer.name,\r\n      installerName: application.installerOrganization?.name ?? undefined,\r\n      senderName,\r\n      dateLabel,\r\n    }),\r\n  )\r\n\r\n  const installerPdf = buildSimplePdf(\r\n    \"Solar Installation Agreement (Installer)\",\r\n    buildInstallerAgreementLines({\r\n      installerName: application.installerOrganization?.name ?? undefined,\r\n      customerName: application.customer.name,\r\n      senderName,\r\n      dateLabel,\r\n      packageName: application.selectedPackage?.name ?? null,\r\n      panelCount: application.selectedPackage?.panelCount ?? null,\r\n      panelType: application.selectedPackage?.panelType ?? null,\r\n      inverterBrand: application.selectedPackage?.inverterBrand ?? null,\r\n      warranty: application.selectedPackage?.warranty ?? null,\r\n    }),\r\n  )\r\n\r\n  const existing = await prisma.agreement.findFirst({\r\n    where: { applicationId: application.id },\r\n  })\r\n\r\n  const agreement = existing\r\n    ? await prisma.agreement.update({\r\n        where: { id: existing.id },\r\n        data: {\r\n          customerId: application.customerId,\r\n          installerOrganizationId: application.installerOrganizationId ?? null,\r\n        },\r\n      })\r\n    : await prisma.agreement.create({\r\n        data: {\r\n          applicationId: application.id,\r\n          customerId: application.customerId,\r\n          installerOrganizationId: application.installerOrganizationId ?? null,\r\n        },\r\n      })\r\n\r\n  const customerPdfUrl = await writePdfToPublic({\r\n    filename: `agreement-${agreement.id}-customer.pdf`,\r\n    buffer: customerPdf,\r\n  })\r\n  const installerPdfUrl = await writePdfToPublic({\r\n    filename: `agreement-${agreement.id}-installer.pdf`,\r\n    buffer: installerPdf,\r\n  })\r\n\r\n  const updated = await prisma.agreement.update({\r\n    where: { id: agreement.id },\r\n    data: {\r\n      customerPdfUrl,\r\n      installerPdfUrl,\r\n      status: \"draft\",\r\n      customerSignedUrl: null,\r\n      installerSignedUrl: null,\r\n      customerSignedAt: null,\r\n      installerSignedAt: null,\r\n      sentAt: null,\r\n      officerApprovedAt: null,\r\n    },\r\n  })\r\n\r\n  await prisma.application.update({\r\n    where: { id: application.id },\r\n    data: { status: \"inspection_approved\" },\r\n  })\r\n\r\n  await sendAgreementNotification(\r\n    application.customerId,\r\n    \"Your agreement has been prepared and will be sent for signature soon.\",\r\n  )\r\n\r\n  return NextResponse.json({ agreement: updated })\r\n}\r\n"],"names":[],"mappings":"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"}}]
}