{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma?: PrismaClient\r\n}\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log:\r\n      process.env.NODE_ENV === \"development\"\r\n        ? [\"error\", \"warn\"]\r\n        : [\"error\"],\r\n  })\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  globalForPrisma.prisma = prisma\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KACE,uCACI;QAAC;QAAS;KAAO,GACjB;AACR;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/lib/auth-server.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\r\nimport \"server-only\"\r\nimport { NextResponse } from \"next/server\"\r\nimport { randomUUID } from \"crypto\"\r\nimport { SignJWT, jwtVerify } from \"jose\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport { prisma } from \"./prisma\"\r\nimport { UserRole } from \"@prisma/client\"\r\n\r\nconst SESSION_COOKIE = \"session_token\"\r\nconst SESSION_DURATION_MS = 1000 * 60 * 60 * 24 * 7\r\n\r\nfunction getSecret() {\r\n  const secret = process.env.JWT_SECRET\r\n  if (!secret) {\r\n    throw new Error(\"Missing JWT_SECRET\")\r\n  }\r\n  return new TextEncoder().encode(secret)\r\n}\r\n\r\nexport async function hashPassword(password: string) {\r\n  return bcrypt.hash(password, 10)\r\n}\r\n\r\nexport async function verifyPassword(password: string, hash: string) {\r\n  return bcrypt.compare(password, hash)\r\n}\r\n\r\nexport async function createAuthSession(userId: string, role: UserRole) {\r\n  const token = randomUUID()\r\n  const expiresAt = new Date(Date.now() + SESSION_DURATION_MS)\r\n\r\n  await prisma.session.create({\r\n    data: {\r\n      token,\r\n      userId,\r\n      expiresAt,\r\n    },\r\n  })\r\n\r\n  const jwt = await new SignJWT({ token, role })\r\n    .setProtectedHeader({ alg: \"HS256\" })\r\n    .setExpirationTime(expiresAt)\r\n    .sign(getSecret())\r\n\r\n  const cookieStore = await cookies()\r\n  cookieStore.set(SESSION_COOKIE, jwt, {\r\n    httpOnly: true,\r\n    sameSite: \"lax\",\r\n    expires: expiresAt,\r\n    path: \"/\",\r\n    secure: process.env.NODE_ENV === \"production\",\r\n  })\r\n  return token\r\n}\r\n\r\nexport async function clearSession() {\r\n  const cookieStore = await cookies()\r\n  const token = cookieStore.get(SESSION_COOKIE)?.value\r\n  if (token) {\r\n    await prisma.session.deleteMany({ where: { token } })\r\n  }\r\n  cookieStore.delete(SESSION_COOKIE)\r\n}\r\n\r\nexport async function getSessionUser() {\r\n  const cookieStore = await cookies()\r\n  const jwt = cookieStore.get(SESSION_COOKIE)?.value\r\n  if (!jwt) return null\r\n\r\n  try {\r\n    const { payload } = await jwtVerify(jwt, getSecret())\r\n    const token = payload.token as string\r\n    if (!token) return null\r\n    const session = await prisma.session.findUnique({\r\n      where: { token },\r\n      include: {\r\n        user: {\r\n          include: { organization: { select: { id: true, name: true, isRejected: true } } },\r\n        },\r\n      },\r\n    })\r\n    if (!session || session.expiresAt < new Date()) {\r\n      return null\r\n    }\r\n    if (session.user.status === \"suspended\") {\r\n      await prisma.session.deleteMany({ where: { token } })\r\n      cookieStore.delete(SESSION_COOKIE)\r\n      return null\r\n    }\r\n    return session.user\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nexport function requireRole(userRole: UserRole, allowed: UserRole[]) {\r\n  if (!allowed.includes(userRole)) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\r\n  }\r\n  return null\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;AAGA,MAAM,iBAAiB;AACvB,MAAM,sBAAsB,OAAO,KAAK,KAAK,KAAK;AAElD,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;IACrC,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IACA,OAAO,IAAI,cAAc,MAAM,CAAC;AAClC;AAEO,eAAe,aAAa,QAAgB;IACjD,OAAO,6KAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,IAAY;IACjE,OAAO,6KAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe,kBAAkB,MAAc,EAAE,IAAc;IACpE,MAAM,QAAQ,IAAA,mHAAU;IACxB,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK;IAExC,MAAM,wJAAM,CAAC,OAAO,CAAC,MAAM,CAAC;QAC1B,MAAM;YACJ;YACA;YACA;QACF;IACF;IAEA,MAAM,MAAM,MAAM,IAAI,sMAAO,CAAC;QAAE;QAAO;IAAK,GACzC,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,WAClB,IAAI,CAAC;IAER,MAAM,cAAc,MAAM,IAAA,2KAAO;IACjC,YAAY,GAAG,CAAC,gBAAgB,KAAK;QACnC,UAAU;QACV,UAAU;QACV,SAAS;QACT,MAAM;QACN,QAAQ,oDAAyB;IACnC;IACA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,2KAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,iBAAiB;IAC/C,IAAI,OAAO;QACT,MAAM,wJAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;IACrD;IACA,YAAY,MAAM,CAAC;AACrB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,2KAAO;IACjC,MAAM,MAAM,YAAY,GAAG,CAAC,iBAAiB;IAC7C,IAAI,CAAC,KAAK,OAAO;IAEjB,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,0MAAS,EAAC,KAAK;QACzC,MAAM,QAAQ,QAAQ,KAAK;QAC3B,IAAI,CAAC,OAAO,OAAO;QACnB,MAAM,UAAU,MAAM,wJAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAC9C,OAAO;gBAAE;YAAM;YACf,SAAS;gBACP,MAAM;oBACJ,SAAS;wBAAE,cAAc;4BAAE,QAAQ;gCAAE,IAAI;gCAAM,MAAM;gCAAM,YAAY;4BAAK;wBAAE;oBAAE;gBAClF;YACF;QACF;QACA,IAAI,CAAC,WAAW,QAAQ,SAAS,GAAG,IAAI,QAAQ;YAC9C,OAAO;QACT;QACA,IAAI,QAAQ,IAAI,CAAC,MAAM,KAAK,aAAa;YACvC,MAAM,wJAAM,CAAC,OAAO,CAAC,UAAU,CAAC;gBAAE,OAAO;oBAAE;gBAAM;YAAE;YACnD,YAAY,MAAM,CAAC;YACnB,OAAO;QACT;QACA,OAAO,QAAQ,IAAI;IACrB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,YAAY,QAAkB,EAAE,OAAmB;IACjE,IAAI,CAAC,QAAQ,QAAQ,CAAC,WAAW;QAC/B,OAAO,+KAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;IACjE;IACA,OAAO;AACT"}},
    {"offset": {"line": 193, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/app/actions/auth.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { redirect } from \"next/navigation\"\r\nimport { UserRole } from \"@prisma/client\"\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { createAuthSession, hashPassword, verifyPassword } from \"@/lib/auth-server\"\r\n\r\nfunction getString(fd: FormData, key: string) {\r\n  const v = fd.get(key)\r\n  return typeof v === \"string\" ? v.trim() : \"\"\r\n}\r\n\r\nexport async function loginAction(_: unknown, formData: FormData) {\r\n  const email = getString(formData, \"email\").toLowerCase()\r\n  const password = getString(formData, \"password\")\r\n  const redirectTo = getString(formData, \"redirect\") || \"/customer/dashboard\"\r\n\r\n  if (!email || !password) {\r\n    return { error: \"Email and password are required\" }\r\n  }\r\n\r\n  const user = await prisma.user.findUnique({ where: { email } })\r\n  if (!user) return { error: \"Invalid credentials\" }\r\n\r\n  if (user.status === \"suspended\") {\r\n    return { error: \"Account is suspended. Please contact support.\" }\r\n  }\r\n\r\n  const ok = await verifyPassword(password, user.passwordHash)\r\n  if (!ok) return { error: \"Invalid credentials\" }\r\n\r\n  // âœ… uses your existing session/cookie helper\r\n  await createAuthSession(user.id, user.role)\r\n\r\n  const roleRedirect =\r\n    user.role === \"officer\"\r\n      ? \"/officer/dashboard\"\r\n      : user.role === \"installer\"\r\n      ? \"/installer/dashboard\"\r\n      : \"/customer/dashboard\"\r\n\r\n  // If redirect is default/home, go by role\r\n  const finalRedirect =\r\n    redirectTo === \"/\" || redirectTo === \"/customer/dashboard\"\r\n      ? roleRedirect\r\n      : redirectTo\r\n\r\n  redirect(finalRedirect)\r\n}\r\n\r\nexport async function registerAction(_: unknown, formData: FormData) {\r\n  const name = getString(formData, \"name\")\r\n  const email = getString(formData, \"email\").toLowerCase()\r\n  const password = getString(formData, \"password\")\r\n  const confirmPassword = getString(formData, \"confirmPassword\")\r\n\r\n  const roleRaw = getString(formData, \"role\") || \"customer\"\r\n  const phone = getString(formData, \"phone\") || undefined\r\n  const address = getString(formData, \"address\") || undefined\r\n\r\n  if (!name || !email || !password) {\r\n    return { error: \"Missing required fields\" }\r\n  }\r\n\r\n  if (password !== confirmPassword) {\r\n    return { error: \"Passwords do not match\" }\r\n  }\r\n\r\n  if (!Object.values(UserRole).includes(roleRaw as UserRole)) {\r\n    return { error: \"Invalid role\" }\r\n  }\r\n\r\n  const role = roleRaw as UserRole\r\n\r\n  const existing = await prisma.user.findUnique({ where: { email } })\r\n  if (existing) return { error: \"Email already registered\" }\r\n\r\n  const passwordHash = await hashPassword(password)\r\n\r\n  let organizationId: string | undefined\r\n\r\n  if (role === UserRole.installer) {\r\n    const companyName = getString(formData, \"companyName\")\r\n    const description = getString(formData, \"description\") || undefined\r\n\r\n    const org = await prisma.organization.create({\r\n      data: {\r\n        name: companyName || name,\r\n        description,\r\n        phone,\r\n        address,\r\n        verified: false,\r\n      },\r\n    })\r\n\r\n    organizationId = org.id\r\n  }\r\n\r\n  const user = await prisma.user.create({\r\n    data: {\r\n      name,\r\n      email,\r\n      passwordHash,\r\n      role,\r\n      status: \"active\",\r\n      phone,\r\n      address,\r\n      organizationId,\r\n      verified: role !== UserRole.installer,\r\n    },\r\n  })\r\n\r\n  await createAuthSession(user.id, user.role)\r\n\r\n  redirect(\r\n    role === UserRole.installer\r\n      ? \"/installer/dashboard\"\r\n      : role === UserRole.officer\r\n      ? \"/officer/dashboard\"\r\n      : \"/customer/dashboard\",\r\n  )\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 323, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dew/404SquadSolarConnect/final/.next-internal/server/app/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {loginAction as '606b73709b0fa3699ff285b8aaeae10729fa2e7bb5'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}